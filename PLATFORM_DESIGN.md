# ç¬¬äºŒé˜¶æ®µï¼šå¹³å°åŒ–è®¾è®¡æ–¹æ¡ˆ

## ğŸ“‹ ç›®æ ‡

å°†ã€Œä¸“å®¶ç”»åƒ Dashboardã€ä»æœ¬åœ°å·¥å…·å‡çº§ä¸ºé€šç”¨ç½‘é¡µåº”ç”¨å¹³å°ï¼Œæ”¯æŒå¤šç”¨æˆ·ã€å¤šé¡¹ç›®ã€å¤šæ¬¡ä¸Šä¼ ã€‚

---

## ğŸ—ï¸ æ¶æ„æ¼”è¿›

### å½“å‰æ¶æ„ï¼ˆç¬¬ä¸€é˜¶æ®µï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           æœ¬åœ°å•ç”¨æˆ·æ¨¡å¼                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Browser  â”€â”€â”€â”€â”€â”€â–º  FastAPI  â”€â”€â”€â”€â”€â”€â–º  Mock Data
â”‚                        â”‚
â”‚                    å†…å­˜ç¼“å­˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç›®æ ‡æ¶æ„ï¼ˆç¬¬äºŒé˜¶æ®µï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å¤šç”¨æˆ·å¹³å°æ¨¡å¼                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Browser â”‚â”€â”€â”€â”€â–ºâ”‚   Nginx      â”‚â”€â”€â”€â”€â–ºâ”‚   FastAPI    â”‚     â”‚
â”‚  â”‚         â”‚     â”‚   (è´Ÿè½½å‡è¡¡)  â”‚     â”‚   (å¤šå®ä¾‹)    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                              â”‚              â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚        â”‚                                     â”‚              â”‚
â”‚        â–¼                                     â–¼              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚PostgreSQLâ”‚  â”‚  Redis   â”‚  â”‚   OSS    â”‚  â”‚ Talent API â”‚  â”‚
â”‚  â”‚ (ç”¨æˆ·/é¡¹ç›®)â”‚  â”‚ (ç¼“å­˜)   â”‚  â”‚ (æ–‡ä»¶)   â”‚  â”‚  (çœŸå®æ•°æ®) â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” å¤šç”¨æˆ·æ”¯æŒ

### ç”¨æˆ·è®¤è¯

```python
# æ–¹æ¡ˆä¸€ï¼šé›†æˆç°æœ‰ç³»ç»Ÿ
# ç›´æ¥å¤ç”¨ meetchances-platform çš„ç”¨æˆ·ä½“ç³»

# æ–¹æ¡ˆäºŒï¼šç‹¬ç«‹è½»é‡è®¤è¯
from fastapi import Depends, HTTPException
from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials

security = HTTPBearer()

async def get_current_user(
    credentials: HTTPAuthorizationCredentials = Depends(security)
) -> User:
    """éªŒè¯ JWT Tokenï¼Œè·å–å½“å‰ç”¨æˆ·"""
    token = credentials.credentials
    try:
        payload = jwt.decode(token, SECRET_KEY, algorithms=["HS256"])
        user_id = payload.get("sub")
        return await get_user_by_id(user_id)
    except JWTError:
        raise HTTPException(status_code=401, detail="æ— æ•ˆçš„è®¤è¯å‡­æ®")
```

### æ•°æ®æ¨¡å‹æ‰©å±•

```python
class User(BaseModel):
    """ç”¨æˆ·æ¨¡å‹"""
    id: str
    email: str
    name: str
    role: str  # admin / manager / viewer

class Project(BaseModel):
    """é¡¹ç›®æ¨¡å‹"""
    id: str
    name: str
    description: Optional[str]
    owner_id: str
    created_at: datetime
    updated_at: datetime

class Upload(BaseModel):
    """ä¸Šä¼ è®°å½•"""
    id: str
    project_id: str
    user_id: str
    filename: str
    talent_count: int
    status: str  # processing / completed / failed
    created_at: datetime
    stats_snapshot: Optional[dict]  # å¿«ç…§ç»Ÿè®¡æ•°æ®
```

---

## ğŸ“‚ å¤šæ¬¡ä¸Šä¼ æ”¯æŒ

### ä¸Šä¼ å†å²ç®¡ç†

```python
@router.get("/projects/{project_id}/uploads")
async def list_uploads(
    project_id: str,
    current_user: User = Depends(get_current_user)
) -> List[Upload]:
    """è·å–é¡¹ç›®çš„ä¸Šä¼ å†å²"""
    return await upload_service.list_by_project(project_id)

@router.get("/uploads/{upload_id}/dashboard")
async def get_upload_dashboard(
    upload_id: str,
    current_user: User = Depends(get_current_user)
) -> DashboardResponse:
    """è·å–ç‰¹å®šä¸Šä¼ çš„ Dashboard æ•°æ®"""
    upload = await upload_service.get(upload_id)
    return upload.stats_snapshot
```

### ç‰ˆæœ¬å¯¹æ¯”åŠŸèƒ½

```python
@router.get("/projects/{project_id}/compare")
async def compare_uploads(
    project_id: str,
    upload_id_1: str,
    upload_id_2: str,
    current_user: User = Depends(get_current_user)
) -> CompareResponse:
    """å¯¹æ¯”ä¸¤æ¬¡ä¸Šä¼ çš„å·®å¼‚"""
    stats_1 = await get_upload_stats(upload_id_1)
    stats_2 = await get_upload_stats(upload_id_2)
    return calculate_diff(stats_1, stats_2)
```

---

## ğŸ”’ æƒé™ä¸æ•°æ®éš”ç¦»

### æƒé™çŸ©é˜µ

| è§’è‰² | æŸ¥çœ‹é¡¹ç›® | ä¸Šä¼ æ–‡ä»¶ | ç®¡ç†æˆå‘˜ | åˆ é™¤é¡¹ç›® |
|------|---------|---------|---------|---------|
| Owner | âœ… | âœ… | âœ… | âœ… |
| Manager | âœ… | âœ… | âŒ | âŒ |
| Viewer | âœ… | âŒ | âŒ | âŒ |

### æ•°æ®éš”ç¦»ç­–ç•¥

```python
# åŸºäºé¡¹ç›®çš„æ•°æ®éš”ç¦»
class ProjectPermission:
    @staticmethod
    async def check_access(user: User, project_id: str, required_role: str):
        """æ£€æŸ¥ç”¨æˆ·å¯¹é¡¹ç›®çš„è®¿é—®æƒé™"""
        membership = await get_project_membership(user.id, project_id)
        if not membership:
            raise HTTPException(status_code=403, detail="æ— æƒè®¿é—®æ­¤é¡¹ç›®")
        
        role_hierarchy = {"owner": 3, "manager": 2, "viewer": 1}
        if role_hierarchy[membership.role] < role_hierarchy[required_role]:
            raise HTTPException(status_code=403, detail="æƒé™ä¸è¶³")

# åœ¨è·¯ç”±ä¸­ä½¿ç”¨
@router.post("/projects/{project_id}/upload")
async def upload_file(
    project_id: str,
    file: UploadFile,
    current_user: User = Depends(get_current_user)
):
    await ProjectPermission.check_access(current_user, project_id, "manager")
    # ... å¤„ç†ä¸Šä¼ 
```

---

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### PostgreSQL è¡¨ç»“æ„

```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE NOT NULL,
    name VARCHAR(100) NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- é¡¹ç›®è¡¨
CREATE TABLE projects (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(200) NOT NULL,
    description TEXT,
    owner_id UUID REFERENCES users(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- é¡¹ç›®æˆå‘˜è¡¨
CREATE TABLE project_members (
    project_id UUID REFERENCES projects(id),
    user_id UUID REFERENCES users(id),
    role VARCHAR(20) NOT NULL,  -- owner, manager, viewer
    joined_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (project_id, user_id)
);

-- ä¸Šä¼ è®°å½•è¡¨
CREATE TABLE uploads (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    project_id UUID REFERENCES projects(id),
    user_id UUID REFERENCES users(id),
    filename VARCHAR(255) NOT NULL,
    file_path VARCHAR(500),
    talent_count INTEGER DEFAULT 0,
    status VARCHAR(20) DEFAULT 'processing',
    stats_snapshot JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ä¸“å®¶æ•°æ®è¡¨ï¼ˆå¯é€‰ï¼Œç”¨äºæŒä¹…åŒ–ï¼‰
CREATE TABLE experts (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    upload_id UUID REFERENCES uploads(id),
    talent_id VARCHAR(100) NOT NULL,
    data JSONB NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

---

## ğŸ”„ API å¯¹æ¥

### æ¥å£é€‚é…å±‚è®¾è®¡

```python
# app/services/talent_api.py

from abc import ABC, abstractmethod

class TalentDataSource(ABC):
    """ä¸“å®¶æ•°æ®æºæŠ½è±¡æ¥å£"""
    
    @abstractmethod
    async def fetch_expert(self, talent_id: str) -> Expert:
        """è·å–å•ä¸ªä¸“å®¶ä¿¡æ¯"""
        pass
    
    @abstractmethod
    async def fetch_experts(self, talent_ids: List[str]) -> List[Expert]:
        """æ‰¹é‡è·å–ä¸“å®¶ä¿¡æ¯"""
        pass

class MockDataSource(TalentDataSource):
    """Mock æ•°æ®æºï¼ˆå¼€å‘æµ‹è¯•ç”¨ï¼‰"""
    
    async def fetch_expert(self, talent_id: str) -> Expert:
        return generate_mock_expert(talent_id)
    
    async def fetch_experts(self, talent_ids: List[str]) -> List[Expert]:
        return [await self.fetch_expert(tid) for tid in talent_ids]

class RealAPIDataSource(TalentDataSource):
    """çœŸå® API æ•°æ®æº"""
    
    def __init__(self, base_url: str, api_key: str):
        self.base_url = base_url
        self.api_key = api_key
        self.client = httpx.AsyncClient()
    
    async def fetch_expert(self, talent_id: str) -> Expert:
        response = await self.client.get(
            f"{self.base_url}/talents/{talent_id}",
            headers={"Authorization": f"Bearer {self.api_key}"}
        )
        response.raise_for_status()
        return Expert(**response.json())
    
    async def fetch_experts(self, talent_ids: List[str]) -> List[Expert]:
        # ä½¿ç”¨æ‰¹é‡æ¥å£æé«˜æ•ˆç‡
        response = await self.client.post(
            f"{self.base_url}/talents/batch",
            json={"talent_ids": talent_ids},
            headers={"Authorization": f"Bearer {self.api_key}"}
        )
        response.raise_for_status()
        return [Expert(**item) for item in response.json()]

# é…ç½®ä½¿ç”¨å“ªä¸ªæ•°æ®æº
def get_data_source() -> TalentDataSource:
    if settings.USE_MOCK_DATA:
        return MockDataSource()
    else:
        return RealAPIDataSource(
            base_url=settings.TALENT_API_URL,
            api_key=settings.TALENT_API_KEY
        )
```

---

## ğŸ³ éƒ¨ç½²æ–¹æ¡ˆ

### Docker Composeï¼ˆå¼€å‘/æµ‹è¯•ï¼‰

```yaml
# docker-compose.yml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "8080:8080"
    environment:
      - DATABASE_URL=postgresql://user:pass@db/expert_dashboard
      - REDIS_URL=redis://redis:6379
      - USE_MOCK_DATA=false
      - TALENT_API_URL=https://api.meetchances.com
    depends_on:
      - db
      - redis
  
  db:
    image: postgres:15
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: pass
      POSTGRES_DB: expert_dashboard
    volumes:
      - postgres_data:/var/lib/postgresql/data
  
  redis:
    image: redis:7
    volumes:
      - redis_data:/data

volumes:
  postgres_data:
  redis_data:
```

### Kubernetesï¼ˆç”Ÿäº§ï¼‰

```yaml
# k8s/deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: expert-dashboard
spec:
  replicas: 3
  selector:
    matchLabels:
      app: expert-dashboard
  template:
    metadata:
      labels:
        app: expert-dashboard
    spec:
      containers:
      - name: app
        image: meetchances/expert-dashboard:latest
        ports:
        - containerPort: 8080
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
        envFrom:
        - secretRef:
            name: expert-dashboard-secrets
```

---

## ğŸ“… å®æ–½è®¡åˆ’

### é˜¶æ®µ 2.1ï¼šå¤šç”¨æˆ·åŸºç¡€ï¼ˆ1-2 å‘¨ï¼‰
- [ ] é›†æˆç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- [ ] æ·»åŠ é¡¹ç›®ç®¡ç†åŠŸèƒ½
- [ ] å®ç°ä¸Šä¼ å†å²

### é˜¶æ®µ 2.2ï¼šæ•°æ®æŒä¹…åŒ–ï¼ˆ1 å‘¨ï¼‰
- [ ] PostgreSQL æ•°æ®åº“é›†æˆ
- [ ] Redis ç¼“å­˜é›†æˆ
- [ ] æ–‡ä»¶å­˜å‚¨ï¼ˆOSSï¼‰

### é˜¶æ®µ 2.3ï¼šAPI å¯¹æ¥ï¼ˆ1 å‘¨ï¼‰
- [ ] å®ç°çœŸå® API æ•°æ®æº
- [ ] æ·»åŠ æ•°æ®åŒæ­¥æœºåˆ¶
- [ ] é”™è¯¯å¤„ç†å’Œé‡è¯•

### é˜¶æ®µ 2.4ï¼šéƒ¨ç½²ä¸Šçº¿ï¼ˆ1 å‘¨ï¼‰
- [ ] Docker é•œåƒæ„å»º
- [ ] K8s éƒ¨ç½²é…ç½®
- [ ] ç›‘æ§å’Œæ—¥å¿—

---

## ğŸ¯ é¢„æœŸæˆæœ

å®Œæˆç¬¬äºŒé˜¶æ®µåï¼Œç³»ç»Ÿå°†æ”¯æŒï¼š

1. **å¤šç”¨æˆ·åä½œ**ï¼šå›¢é˜Ÿæˆå‘˜å¯å…±åŒæŸ¥çœ‹å’Œåˆ†æä¸“å®¶æ•°æ®
2. **é¡¹ç›®ç®¡ç†**ï¼šæŒ‰é¡¹ç›®ç»„ç»‡ä¸“å®¶ç”»åƒåˆ†æ
3. **å†å²è¿½æº¯**ï¼šä¿å­˜æ¯æ¬¡ä¸Šä¼ çš„åˆ†æç»“æœï¼Œæ”¯æŒç‰ˆæœ¬å¯¹æ¯”
4. **æƒé™æ§åˆ¶**ï¼šç»†ç²’åº¦çš„è®¿é—®æƒé™ç®¡ç†
5. **çœŸå®æ•°æ®**ï¼šå¯¹æ¥ç”Ÿäº§ç¯å¢ƒçš„ä¸“å®¶æ•°æ® API
6. **é«˜å¯ç”¨**ï¼šå®¹å™¨åŒ–éƒ¨ç½²ï¼Œæ”¯æŒæ°´å¹³æ‰©å±•

---

Made with â¤ï¸ by MeetChances Team
